---
title: "Proyecto Final"
author: "Luis Domínguez & Miguel Gutiérrez"
date: '2024-04-22'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tseries)
library(dplyr)
library(xts)
```


# Proyecto Final

## Primera Parte: Selección del Tema y Análisis Exploratorio de los Datos

### 1. Selección del Tema
Selecciona un tema de tu interés al que se pueda aplicar un modelo ARIMA para una serie de tiempo.

**Predicción de precios de acciones de BMW**

### 2. Justificación del Tema
Justifica brevemente la relevancia del tema y la herramienta que utilizarás (modelo ARIMA para una serie de tiempo). Busca antecedentes en la literatura especializada.

**Utilizaremos los datos históricos del precio de las acciones de BMW y el modelo ARIMA para predecir el comportamiento futuro de sus precios de acciones.**

### 3. Recopilación de Datos
Recaba los datos que necesites y determina la ventana de tiempo que sea más adecuada para tu investigación.
```{r}
Xt<-read.csv("DatosBMW.csv")
Xt_cierre <- select(Xt, Cierre)
# Xt_cierre<-as.ts(Xt_cierre)
# plot(Xt_cierre, main="Precio de las acciones de BMW", ylab="Precio", xlab="Tiempo")
```


### 4. Descripción de la Variable
Describe la variable que utilizarás, los nombres que utilizarás, las unidades, la fuente de dónde obtuviste los datos.

**Variable a utilizar: cierre del precio diario del acción**

**Unidades: Euros**

**Fuente: https://mx.investing.com/equities/bay-mot-werke-historical-data**

### 5. Organización de Datos en RStudio
Organiza los datos en una tabla para RStudio. Coloca los nombres adecuados en las columnas usando la biblioteca `dplyr()`.
```{r}
Xt_cierre<-ts(Xt_cierre, start=c(2009,99), end=c(2024,113), frequency=365)
Xt_cierre
```


### 6. Gráfica de la Serie de Tiempo
Elabora una gráfica de tu serie de tiempo. Cada gráfica debe de ir acompañada de una breve explicación o descripción. Cada afirmación debe de ir acompañada de una breve justificación. Además, debe de ir con los nombres adecuados en los ejes Y y X. Usa las funciones `xlab` y `ylab` de la función `plot()`.
```{r}
plot(Xt_cierre, main="Precio de las acciones de BMW", ylab="Precio", xlab="Tiempo")

```

La gráfica nos muestra el precio de las acciones en euros de la empresa BMW desde el 2009 hasta el 22 de abril del 2024.

### 7. Prueba de Estacionariedad
Determina si tu serie de tiempo es estacionaria o no. Utiliza la prueba de Dickey Fuller Aumentada. Determina si es integrada y de qué orden.
```{r}
adf.test(Xt_cierre, alternative = "stationary")

```
Nuestra serie de tiempo sí es estacionaria por el valor de p<0.05. Por lo tanto, no es integrada.

### 8. Función de Autocorrelación (ACF)
Grafica la ACF de tu serie de tiempo. Escribe los estimadores de la ACF de tu serie de tiempo.
```{r}
acfx<-acf(Xt_cierre, main="ACF Precio de las acciones de BMW")
acfx
```


### 9. Función de Autocorrelación Parcial (PACF)
Grafica la PACF de tu serie de tiempo. Escribe los estimadores de la PACF de tu serie de tiempo.
```{r}
pacfx<-pacf(Xt_cierre, main="PACF Precio de las acciones de BMW")
pacfx
```

## Segunda parte.
### Ajuste del modelo.

#### (1) Mejor modelo AIC
**(a)** Ajusta un modelo ARIMA a tu serie de tiempo. En esta ocasión utilizaremos el criterio de información de Akaike para seleccionar el mejor modelo. Usa el método visto en clase. Imprime una tabla con los 5 mejores modelos, según AIC.
```{r}
P<-2
D<-1
Q<-5
tabla<-data.frame()
for(p in 0:P){
  for(d in 0:D){
    for(q in 0:Q){
      modelo<-arima(Xt_cierre,order=c(p,d,q))
      AIC<-AIC(modelo)
      sbic<-AIC(modelo,k=log(length(Xt_cierre)))
      tabla<-rbind(tabla,c(p,d,q,AIC,sbic))
    }
  }
}
tabla<-rename(tabla, 'p'=1,'d'=2,'q'=3,'AIC'=4,'sbic'=5)
tabla<-tabla[order(tabla$AIC),]
tabla <- head(tabla, 5)
tabla
```


**(b)** Determina si cada uno de los coeficientes del mejor modelo según AIC es significativo, incluyendo el intercepto. En caso de que un coeficiente no sea significativo pasa al siguiente mejor modelo.
```{r}
ajuste1<-arima(Xt_cierre,order=c(0,1,0))
ajuste1
confint(ajuste1)
```

El modelo (0,1,0) representa una caminata aleatoria

**(c)** Calcula los intervalos de confianza de los estimadores del mejor modelo.

Como es una caminata aleatoria, no hay intervalos de confianza.

**(d)** Escribe la ecuación del mejor modelo.
Un modelo ARIMA(p, d, q) puede ser escrito de la forma:
$$(1 - \alpha_1R - \alpha_2R^2 - ... - \alpha_pR^p)(1 - R)^dX_t = c + (1 + \theta_1R + \theta_2R^2 + ... + \theta_qR^q)W_t$$
donde \( R \) es el operador rezago:
$$RX_t = X_{t-1}$$
$$R^2X_t = X_{t-2}$$
$$R^nX_t = X_{t-n}$$
$X_t=W_t$ es un proceso estacionario de ruido blanco.

**(e)** Calcula los intervalos de confianza para los parámetros que calculaste.
```{r}
confint(ajuste1)
```


#### (2) Mejor modelo de ajuste de R.
**(a)** Usa la función de R `auto.arima(X)` donde \( X \) es la serie de tiempo. Para que R ajuste un modelo ARIMA de manera automática.

**(b)** Determina si cada uno de los coeficientes del modelo escogido es significativo, incluyendo el intercepto. En caso de que un coeficiente no sea significativo pasa al siguiente mejor modelo.

**(c)** Escribe la ecuación de tu modelo.

**(d)** Calcula los intervalos de confianza para los parámetros que calculaste.
